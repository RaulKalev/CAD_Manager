<Window
    x:Class="CAD_Manager.UI.UniversalPopupWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
    Title="Popup"
    Width="400"
    Height="200"
    MinWidth="300"
    MinHeight="150"
    AllowsTransparency="True"
    Background="Transparent"
    SizeToContent="Height"
    WindowStartupLocation="CenterOwner"
    WindowStyle="None">

    <Grid Background="Transparent">
        <!--  Outer Border with Opacity and Blur  -->
        <Border
            BorderBrush="{DynamicResource BorderBrush}"
            BorderThickness="2"
            CornerRadius="10"
            Opacity="0.7"
            SnapsToDevicePixels="True">
            <Border.Effect>
                <BlurEffect KernelType="Gaussian" Radius="2" />
            </Border.Effect>
        </Border>

        <!--  Content Container  -->
        <Border
            Margin="2"
            Background="{DynamicResource PrimaryBackgroundBrush}"
            CornerRadius="10">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="32" />
                    <!--  Title Bar  -->
                    <RowDefinition Height="*" />
                    <!--  Content  -->
                    <RowDefinition Height="Auto" />
                    <!--  Buttons  -->
                </Grid.RowDefinitions>

                <!--  Title Bar  -->
                <Border
                    Grid.Row="0"
                    Background="{DynamicResource PrimaryBackgroundBrush}"
                    CornerRadius="10,10,0,0"
                    MouseLeftButtonDown="TitleBar_MouseLeftButtonDown">
                    <Grid>
                        <TextBlock
                            x:Name="TitleText"
                            Margin="15,0,0,0"
                            HorizontalAlignment="Left"
                            VerticalAlignment="Center"
                            FontSize="14"
                            FontWeight="SemiBold"
                            Foreground="{DynamicResource ForegroundBrush}"
                            Text="Title" />

                        <!--  Close Button  -->
                        <Button
                            x:Name="CloseButton"
                            Width="30"
                            Height="30"
                            Margin="0,0,5,0"
                            HorizontalAlignment="Right"
                            Background="Transparent"
                            BorderThickness="0"
                            Click="CloseButton_Click">
                            <Button.Template>
                                <ControlTemplate TargetType="Button">
                                    <Grid Background="Transparent">
                                        <materialDesign:PackIcon
                                            x:Name="CloseIcon"
                                            Width="20"
                                            Height="20"
                                            HorizontalAlignment="Center"
                                            VerticalAlignment="Center"
                                            Foreground="{DynamicResource IconBrush}"
                                            Kind="CloseCircleOutline" />
                                    </Grid>
                                    <ControlTemplate.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter TargetName="CloseIcon" Property="Foreground" Value="#DC6B6B" />
                                        </Trigger>
                                        <Trigger Property="IsPressed" Value="True">
                                            <Setter TargetName="CloseIcon" Property="Foreground" Value="#B42C2C" />
                                        </Trigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </Button.Template>
                        </Button>
                    </Grid>
                </Border>

                <!--  Content Area  -->
                <Grid Grid.Row="1" Margin="20,10,20,10">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>

                    <!--  Icon  -->
                    <materialDesign:PackIcon
                        x:Name="MessageIcon"
                        Grid.Column="0"
                        Width="32"
                        Height="32"
                        Margin="0,0,15,0"
                        VerticalAlignment="Top"
                        Foreground="{DynamicResource AccentBrush}"
                        Kind="Information" />

                    <!--  Message Text  -->
                    <TextBlock
                        x:Name="MessageText"
                        Grid.Column="1"
                        VerticalAlignment="Center"
                        FontSize="14"
                        Foreground="{DynamicResource ForegroundBrush}"
                        Text="Message content goes here."
                        TextWrapping="Wrap" />
                </Grid>

                <!--  Buttons Area  -->
                <StackPanel
                    x:Name="ButtonsPanel"
                    Grid.Row="2"
                    Margin="0,10,15,15"
                    HorizontalAlignment="Right"
                    Orientation="Horizontal">
                    <!--  Buttons will be added dynamically or controlled by visibility  -->
                    <Button
                        x:Name="Button1"
                        MinWidth="80"
                        Height="32"
                        Margin="10,0,0,0"
                        Background="{DynamicResource SecondaryBackgroundBrush}"
                        BorderBrush="{DynamicResource BorderBrush}"
                        BorderThickness="1"
                        Click="Button1_Click"
                        Content="Button 1"
                        Foreground="{DynamicResource ForegroundBrush}"
                        Visibility="Collapsed">
                        <Button.Style>
                            <Style TargetType="Button">
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="Button">
                                            <Border
                                                Background="{TemplateBinding Background}"
                                                BorderBrush="{TemplateBinding BorderBrush}"
                                                BorderThickness="{TemplateBinding BorderThickness}"
                                                CornerRadius="5">
                                                <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
                                            </Border>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                                <Style.Triggers>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter Property="Opacity" Value="0.8" />
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </Button.Style>
                    </Button>

                    <Button
                        x:Name="Button2"
                        MinWidth="80"
                        Height="32"
                        Margin="10,0,0,0"
                        Background="{DynamicResource SecondaryBackgroundBrush}"
                        BorderBrush="{DynamicResource BorderBrush}"
                        BorderThickness="1"
                        Click="Button2_Click"
                        Content="Button 2"
                        Foreground="{DynamicResource ForegroundBrush}"
                        Visibility="Collapsed">
                        <Button.Style>
                            <Style TargetType="Button">
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="Button">
                                            <Border
                                                Background="{TemplateBinding Background}"
                                                BorderBrush="{TemplateBinding BorderBrush}"
                                                BorderThickness="{TemplateBinding BorderThickness}"
                                                CornerRadius="5">
                                                <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
                                            </Border>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                                <Style.Triggers>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter Property="Opacity" Value="0.8" />
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </Button.Style>
                    </Button>

                    <Button
                        x:Name="Button3"
                        MinWidth="80"
                        Height="32"
                        Margin="10,0,0,0"
                        Background="{DynamicResource SecondaryBackgroundBrush}"
                        BorderBrush="{DynamicResource BorderBrush}"
                        BorderThickness="1"
                        Click="Button3_Click"
                        Content="Button 3"
                        Foreground="{DynamicResource ForegroundBrush}"
                        Visibility="Collapsed">
                        <Button.Style>
                            <Style TargetType="Button">
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="Button">
                                            <Border
                                                Background="{TemplateBinding Background}"
                                                BorderBrush="{TemplateBinding BorderBrush}"
                                                BorderThickness="{TemplateBinding BorderThickness}"
                                                CornerRadius="5">
                                                <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
                                            </Border>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                                <Style.Triggers>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter Property="Opacity" Value="0.8" />
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </Button.Style>
                    </Button>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</Window>
